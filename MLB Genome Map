{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "6795efdf",
   "metadata": {
    "papermill": {
     "duration": 0.005302,
     "end_time": "2026-02-16T20:45:48.335104",
     "exception": false,
     "start_time": "2026-02-16T20:45:48.329802",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<div style=\"background: linear-gradient(135deg, #002D72 0%, #C41E3A 50%, #002D72 100%); padding: 40px 30px; border-radius: 15px; margin-bottom: 20px;\">\n",
    "    <h1 style=\"color: #FFFFFF; margin: 0; font-size: 42px; text-align: center;\">‚öæ Baseball Genome Map</h1>\n",
    "    <h3 style=\"color: #C0C0C0; text-align: center; font-weight: 300; margin-top: 10px;\">120 Years of MLB's Statistical DNA (1901‚ÄìPresent)</h3>\n",
    "    <p style=\"color: #A0A0A0; text-align: center; font-size: 14px; margin-top: 15px;\">t-SNE Projection ‚Ä¢ Era Similarity Matrix ‚Ä¢ Three True Outcomes ‚Ä¢ Pitching Revolution</p>\n",
    "</div>\n",
    "\n",
    "---\n",
    "\n",
    "## üìä Executive Summary\n",
    "\n",
    "<div style=\"background-color: #f0f4f8; padding: 20px; border-radius: 10px; border-left: 5px solid #002D72;\">\n",
    "\n",
    "| Key Finding | Impact | Method |\n",
    "|-------------|--------|--------|\n",
    "| **Baseball eras form distinct \"islands\" in strategy space** | Confirms eras aren't gradual ‚Äî they're phase shifts | t-SNE dimensionality reduction |\n",
    "| **TTO rate has grown 2.5x+ since 1901** | Balls in play are vanishing from modern baseball | Plate appearance decomposition |\n",
    "| **2020s baseball is more different from 1990 than 1990 from 1950** | The pace of change is *accelerating* | Cosine similarity matrix |\n",
    "| **Complete games declined 95%+** | The most total strategic reversal in any sport | Time series analysis |\n",
    "| **Strikeouts have increased 270%** | Contact hitting is a dying art | Era fingerprint comparison |\n",
    "\n",
    "</div>\n",
    "\n",
    "---\n",
    "\n",
    "## üìë Table of Contents\n",
    "\n",
    "1. [Setup & Data Loading](#1)\n",
    "2. [Data Quality Assessment](#2)\n",
    "3. [Data Preparation & Era Labels](#3)\n",
    "4. [Three True Outcomes Explosion](#4)\n",
    "5. [The Vanishing Contact Hitter](#5)\n",
    "6. [Baseball Genome Map (t-SNE)](#6)\n",
    "7. [Era Similarity Matrix](#7)\n",
    "8. [The Pitching Revolution](#8)\n",
    "9. [Era Fingerprints](#9)\n",
    "10. [Conclusions](#10)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6c9eda62",
   "metadata": {
    "papermill": {
     "duration": 0.004085,
     "end_time": "2026-02-16T20:45:48.343634",
     "exception": false,
     "start_time": "2026-02-16T20:45:48.339549",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"1\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">üì¶ 1. Setup & Data Loading</h2>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "583eff42",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:48.353503Z",
     "iopub.status.busy": "2026-02-16T20:45:48.353176Z",
     "iopub.status.idle": "2026-02-16T20:45:55.397237Z",
     "shell.execute_reply": "2026-02-16T20:45:55.396316Z"
    },
    "papermill": {
     "duration": 7.051438,
     "end_time": "2026-02-16T20:45:55.399142",
     "exception": false,
     "start_time": "2026-02-16T20:45:48.347704",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ All libraries loaded\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import plotly.express as px\n",
    "import plotly.graph_objects as go\n",
    "from plotly.subplots import make_subplots\n",
    "import plotly.io as pio\n",
    "from sklearn.preprocessing import StandardScaler\n",
    "from sklearn.manifold import TSNE\n",
    "from sklearn.metrics import pairwise_distances\n",
    "import os, warnings\n",
    "warnings.filterwarnings('ignore')\n",
    "\n",
    "pio.renderers.default = 'iframe'\n",
    "pio.templates.default = 'plotly_white'\n",
    "\n",
    "MLB_RED  = '#C41E3A'\n",
    "MLB_BLUE = '#002D72'\n",
    "MLB_GOLD = '#FFD700'\n",
    "\n",
    "print('‚úÖ All libraries loaded')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "810caffc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:55.409281Z",
     "iopub.status.busy": "2026-02-16T20:45:55.408969Z",
     "iopub.status.idle": "2026-02-16T20:45:55.437186Z",
     "shell.execute_reply": "2026-02-16T20:45:55.436090Z"
    },
    "papermill": {
     "duration": 0.035528,
     "end_time": "2026-02-16T20:45:55.439032",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.403504",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Available files:\n",
      "  üìÑ mlb_stats_1901_to_2025.csv                     (0.22 MB)\n"
     ]
    }
   ],
   "source": [
    "INPUT_DIR = '/kaggle/input/datasets/diazk2/mlb-statistics-1901-present'\n",
    "print('Available files:')\n",
    "for f in sorted(os.listdir(INPUT_DIR)):\n",
    "    size = os.path.getsize(os.path.join(INPUT_DIR, f)) / 1e6\n",
    "    print(f'  üìÑ {f:45s}  ({size:.2f} MB)')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "d761e3b4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:55.449550Z",
     "iopub.status.busy": "2026-02-16T20:45:55.449152Z",
     "iopub.status.idle": "2026-02-16T20:45:55.485810Z",
     "shell.execute_reply": "2026-02-16T20:45:55.484771Z"
    },
    "papermill": {
     "duration": 0.044021,
     "end_time": "2026-02-16T20:45:55.487644",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.443623",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "üìÑ mlb_stats_1901_to_2025.csv ‚Äî 2,690 rows √ó 16 cols\n",
      "   Columns: ['team_name', 'year', 'wins', 'losses', 'winning_percentage', 'games_behind', 'wild_card_games_behind', 'record_in_the_last_10_games', 'current_streak', 'runs_scored', 'runs_allowed', 'run_differential']...\n"
     ]
    }
   ],
   "source": [
    "csv_files = sorted([f for f in os.listdir(INPUT_DIR) if f.endswith('.csv')])\n",
    "dfs = {}\n",
    "for f in csv_files:\n",
    "    tmp = pd.read_csv(os.path.join(INPUT_DIR, f))\n",
    "    tmp.columns = tmp.columns.str.strip().str.lower().str.replace(' ', '_')\n",
    "    dfs[f] = tmp\n",
    "    print(f'\\nüìÑ {f} ‚Äî {tmp.shape[0]:,} rows √ó {tmp.shape[1]} cols')\n",
    "    print(f'   Columns: {list(tmp.columns[:12])}{\"...\" if len(tmp.columns) > 12 else \"\"}')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "b71bb87e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:55.498830Z",
     "iopub.status.busy": "2026-02-16T20:45:55.497943Z",
     "iopub.status.idle": "2026-02-16T20:45:55.530898Z",
     "shell.execute_reply": "2026-02-16T20:45:55.530087Z"
    },
    "papermill": {
     "duration": 0.040397,
     "end_time": "2026-02-16T20:45:55.532554",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.492157",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "‚úÖ Using: mlb_stats_1901_to_2025.csv  (2,690 rows √ó 16 cols)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>team_name</th>\n",
       "      <th>year</th>\n",
       "      <th>wins</th>\n",
       "      <th>losses</th>\n",
       "      <th>winning_percentage</th>\n",
       "      <th>games_behind</th>\n",
       "      <th>wild_card_games_behind</th>\n",
       "      <th>record_in_the_last_10_games</th>\n",
       "      <th>current_streak</th>\n",
       "      <th>runs_scored</th>\n",
       "      <th>runs_allowed</th>\n",
       "      <th>run_differential</th>\n",
       "      <th>expected_win_loss_record</th>\n",
       "      <th>record_at_home</th>\n",
       "      <th>record_when_away</th>\n",
       "      <th>record_against_top_50_percent</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Pittsburgh Pirates</td>\n",
       "      <td>1901</td>\n",
       "      <td>90</td>\n",
       "      <td>49</td>\n",
       "      <td>0.647</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>6-4</td>\n",
       "      <td>W1</td>\n",
       "      <td>776</td>\n",
       "      <td>534</td>\n",
       "      <td>242</td>\n",
       "      <td>92-47</td>\n",
       "      <td>45-24</td>\n",
       "      <td>45-25</td>\n",
       "      <td>47-32</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Chicago White Sox</td>\n",
       "      <td>1901</td>\n",
       "      <td>83</td>\n",
       "      <td>53</td>\n",
       "      <td>0.610</td>\n",
       "      <td>5.5</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5-5</td>\n",
       "      <td>W1</td>\n",
       "      <td>819</td>\n",
       "      <td>631</td>\n",
       "      <td>188</td>\n",
       "      <td>84-52</td>\n",
       "      <td>49-21</td>\n",
       "      <td>34-32</td>\n",
       "      <td>44-34</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Philadelphia Phillies</td>\n",
       "      <td>1901</td>\n",
       "      <td>83</td>\n",
       "      <td>57</td>\n",
       "      <td>0.593</td>\n",
       "      <td>7.5</td>\n",
       "      <td>NaN</td>\n",
       "      <td>7-3</td>\n",
       "      <td>L1</td>\n",
       "      <td>668</td>\n",
       "      <td>543</td>\n",
       "      <td>125</td>\n",
       "      <td>83-57</td>\n",
       "      <td>46-23</td>\n",
       "      <td>37-34</td>\n",
       "      <td>38-42</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "               team_name  year  wins  losses  winning_percentage  \\\n",
       "0     Pittsburgh Pirates  1901    90      49               0.647   \n",
       "1      Chicago White Sox  1901    83      53               0.610   \n",
       "2  Philadelphia Phillies  1901    83      57               0.593   \n",
       "\n",
       "   games_behind  wild_card_games_behind record_in_the_last_10_games  \\\n",
       "0           NaN                     NaN                         6-4   \n",
       "1           5.5                     NaN                         5-5   \n",
       "2           7.5                     NaN                         7-3   \n",
       "\n",
       "  current_streak  runs_scored  runs_allowed  run_differential  \\\n",
       "0             W1          776           534               242   \n",
       "1             W1          819           631               188   \n",
       "2             L1          668           543               125   \n",
       "\n",
       "  expected_win_loss_record record_at_home record_when_away  \\\n",
       "0                    92-47          45-24            45-25   \n",
       "1                    84-52          49-21            34-32   \n",
       "2                    83-57          46-23            37-34   \n",
       "\n",
       "  record_against_top_50_percent  \n",
       "0                         47-32  \n",
       "1                         44-34  \n",
       "2                         38-42  "
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Pick the best dataset\n",
    "best_key = None\n",
    "for key, tmp in dfs.items():\n",
    "    if any(kw in key.lower() for kw in ['batting','team','hitting']):\n",
    "        best_key = key; break\n",
    "if not best_key:\n",
    "    best_key = max(dfs.keys(), key=lambda k: len(dfs[k]))\n",
    "df = dfs[best_key].copy()\n",
    "print(f'\\n‚úÖ Using: {best_key}  ({df.shape[0]:,} rows √ó {df.shape[1]} cols)')\n",
    "df.head(3)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9fc12428",
   "metadata": {
    "papermill": {
     "duration": 0.004584,
     "end_time": "2026-02-16T20:45:55.541848",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.537264",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"2\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">üîç 2. Data Quality Assessment</h2>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "c4fa3f11",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:55.552653Z",
     "iopub.status.busy": "2026-02-16T20:45:55.552002Z",
     "iopub.status.idle": "2026-02-16T20:45:55.574285Z",
     "shell.execute_reply": "2026-02-16T20:45:55.573455Z"
    },
    "papermill": {
     "duration": 0.029737,
     "end_time": "2026-02-16T20:45:55.576070",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.546333",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>dtype</th>\n",
       "      <th>non_null</th>\n",
       "      <th>null_%</th>\n",
       "      <th>unique</th>\n",
       "      <th>example</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>team_name</th>\n",
       "      <td>object</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>60</td>\n",
       "      <td>Pittsburgh Pirates</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>year</th>\n",
       "      <td>int64</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>124</td>\n",
       "      <td>1901</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wins</th>\n",
       "      <td>int64</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>94</td>\n",
       "      <td>90</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>losses</th>\n",
       "      <td>int64</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>98</td>\n",
       "      <td>49</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>winning_percentage</th>\n",
       "      <td>float64</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>338</td>\n",
       "      <td>0.647</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>games_behind</th>\n",
       "      <td>float64</td>\n",
       "      <td>2559</td>\n",
       "      <td>4.9</td>\n",
       "      <td>131</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wild_card_games_behind</th>\n",
       "      <td>float64</td>\n",
       "      <td>662</td>\n",
       "      <td>75.4</td>\n",
       "      <td>83</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>record_in_the_last_10_games</th>\n",
       "      <td>object</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>23</td>\n",
       "      <td>6-4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>current_streak</th>\n",
       "      <td>object</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>27</td>\n",
       "      <td>W1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>runs_scored</th>\n",
       "      <td>int64</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>557</td>\n",
       "      <td>776</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>runs_allowed</th>\n",
       "      <td>int64</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>556</td>\n",
       "      <td>534</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>run_differential</th>\n",
       "      <td>int64</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>547</td>\n",
       "      <td>242</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>expected_win_loss_record</th>\n",
       "      <td>object</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>607</td>\n",
       "      <td>92-47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>record_at_home</th>\n",
       "      <td>object</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>498</td>\n",
       "      <td>45-24</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>record_when_away</th>\n",
       "      <td>object</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>482</td>\n",
       "      <td>45-25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>record_against_top_50_percent</th>\n",
       "      <td>object</td>\n",
       "      <td>2690</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1177</td>\n",
       "      <td>47-32</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                 dtype  non_null  null_%  unique  \\\n",
       "team_name                       object      2690     0.0      60   \n",
       "year                             int64      2690     0.0     124   \n",
       "wins                             int64      2690     0.0      94   \n",
       "losses                           int64      2690     0.0      98   \n",
       "winning_percentage             float64      2690     0.0     338   \n",
       "games_behind                   float64      2559     4.9     131   \n",
       "wild_card_games_behind         float64       662    75.4      83   \n",
       "record_in_the_last_10_games     object      2690     0.0      23   \n",
       "current_streak                  object      2690     0.0      27   \n",
       "runs_scored                      int64      2690     0.0     557   \n",
       "runs_allowed                     int64      2690     0.0     556   \n",
       "run_differential                 int64      2690     0.0     547   \n",
       "expected_win_loss_record        object      2690     0.0     607   \n",
       "record_at_home                  object      2690     0.0     498   \n",
       "record_when_away                object      2690     0.0     482   \n",
       "record_against_top_50_percent   object      2690     0.0    1177   \n",
       "\n",
       "                                          example  \n",
       "team_name                      Pittsburgh Pirates  \n",
       "year                                         1901  \n",
       "wins                                           90  \n",
       "losses                                         49  \n",
       "winning_percentage                          0.647  \n",
       "games_behind                                  NaN  \n",
       "wild_card_games_behind                        NaN  \n",
       "record_in_the_last_10_games                   6-4  \n",
       "current_streak                                 W1  \n",
       "runs_scored                                   776  \n",
       "runs_allowed                                  534  \n",
       "run_differential                              242  \n",
       "expected_win_loss_record                    92-47  \n",
       "record_at_home                              45-24  \n",
       "record_when_away                            45-25  \n",
       "record_against_top_50_percent               47-32  "
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "audit = pd.DataFrame({'dtype':df.dtypes,'non_null':df.notnull().sum(),\n",
    "    'null_%':(df.isnull().sum()/len(df)*100).round(1),'unique':df.nunique(),'example':df.iloc[0]})\n",
    "audit"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1dce878e",
   "metadata": {
    "papermill": {
     "duration": 0.004867,
     "end_time": "2026-02-16T20:45:55.585931",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.581064",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"3\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">‚öôÔ∏è 3. Data Preparation & Era Labels</h2>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "c7df7de5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:55.597053Z",
     "iopub.status.busy": "2026-02-16T20:45:55.596759Z",
     "iopub.status.idle": "2026-02-16T20:45:55.606982Z",
     "shell.execute_reply": "2026-02-16T20:45:55.606178Z"
    },
    "papermill": {
     "duration": 0.018017,
     "end_time": "2026-02-16T20:45:55.608727",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.590710",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div style=\"background:#f8f9fa;padding:15px;border-radius:10px;\"><table style=\"width:100%;font-size:14px;\"><tr style=\"background:#002D72;color:white;\"><th style=\"padding:8px;\">‚úì</th><th style=\"padding:8px;\">Stat</th><th style=\"padding:8px;\">Column</th></tr><tr><td>‚úÖ</td><td><b>year</b></td><td><code>year</code></td></tr><tr><td>‚úÖ</td><td><b>runs_scored</b></td><td><code>runs_scored</code></td></tr><tr><td>‚úÖ</td><td><b>runs_allowed</b></td><td><code>runs_allowed</code></td></tr><tr><td>‚úÖ</td><td><b>run_diff</b></td><td><code>run_differential</code></td></tr><tr><td>‚úÖ</td><td><b>wins</b></td><td><code>wins</code></td></tr><tr><td>‚úÖ</td><td><b>losses</b></td><td><code>losses</code></td></tr><tr><td>‚úÖ</td><td><b>win_pct</b></td><td><code>winning_percentage</code></td></tr><tr><td>‚úÖ</td><td><b>team</b></td><td><code>team_name</code></td></tr></table></div>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "def find_col(df, keywords, exclude=None):\n",
    "    exclude = exclude or []\n",
    "    for col in df.columns:\n",
    "        col_low = col.lower()\n",
    "        for kw in keywords:\n",
    "            # Require either exact match or keyword is a substantial substring (>3 chars)\n",
    "            if col_low == kw or (len(kw) > 3 and kw in col_low):\n",
    "                if not any(ex in col_low for ex in exclude):\n",
    "                    return col\n",
    "    return None\n",
    "\n",
    "# Map to ACTUAL columns in this standings/team-level dataset\n",
    "COLS = {\n",
    "    'year':         find_col(df, ['year', 'season']),\n",
    "    'runs_scored':  find_col(df, ['runs_scored', 'runs_for']),\n",
    "    'runs_allowed': find_col(df, ['runs_allowed', 'runs_against']),\n",
    "    'run_diff':     find_col(df, ['run_differential', 'run_diff']),\n",
    "    'wins':         find_col(df, ['wins']),\n",
    "    'losses':       find_col(df, ['losses']),\n",
    "    'win_pct':      find_col(df, ['winning_percentage', 'win_pct']),\n",
    "    'team':         find_col(df, ['team_name', 'team_', 'franchise']),\n",
    "}\n",
    "\n",
    "from IPython.display import HTML\n",
    "rows = ''.join(f'<tr><td>{\"‚úÖ\" if v else \"‚ùå\"}</td><td><b>{k}</b></td><td><code>{v or \"NOT FOUND\"}</code></td></tr>' for k,v in COLS.items())\n",
    "HTML(f'<div style=\"background:#f8f9fa;padding:15px;border-radius:10px;\"><table style=\"width:100%;font-size:14px;\"><tr style=\"background:#002D72;color:white;\"><th style=\"padding:8px;\">‚úì</th><th style=\"padding:8px;\">Stat</th><th style=\"padding:8px;\">Column</th></tr>{rows}</table></div>')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "bafc9c2c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:55.620773Z",
     "iopub.status.busy": "2026-02-16T20:45:55.620425Z",
     "iopub.status.idle": "2026-02-16T20:45:55.653533Z",
     "shell.execute_reply": "2026-02-16T20:45:55.652708Z"
    },
    "papermill": {
     "duration": 0.041221,
     "end_time": "2026-02-16T20:45:55.655321",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.614100",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ 124 seasons | 1901‚Äì2025\n",
      "   Teams per season (latest): 30\n",
      "   Numeric features: 8\n"
     ]
    }
   ],
   "source": [
    "if COLS['year']:\n",
    "    df['year'] = pd.to_numeric(df[COLS['year']], errors='coerce')\n",
    "    df = df[df['year'].between(1901, 2030)].copy()\n",
    "\n",
    "# Ensure all numeric columns are actually numeric\n",
    "for key in ['runs_scored','runs_allowed','run_diff','wins','losses','win_pct']:\n",
    "    if COLS.get(key) and COLS[key] in df.columns:\n",
    "        df[COLS[key]] = pd.to_numeric(df[COLS[key]], errors='coerce')\n",
    "\n",
    "def assign_era(y):\n",
    "    if y<=1919: return 'Deadball Era'\n",
    "    elif y<=1941: return 'Live Ball Era'\n",
    "    elif y<=1945: return 'WWII Era'\n",
    "    elif y<=1962: return 'Post-War Era'\n",
    "    elif y<=1976: return 'Expansion Era'\n",
    "    elif y<=1993: return 'Free Agency Era'\n",
    "    elif y<=2005: return 'Steroid Era'\n",
    "    elif y<=2014: return 'Post-Steroid Era'\n",
    "    else: return 'Modern Era'\n",
    "\n",
    "df['era'] = df['year'].apply(assign_era)\n",
    "\n",
    "# Aggregate to season-level averages (across all teams per year)\n",
    "num_cols = [c for c in df.select_dtypes(include=[np.number]).columns if c != 'year']\n",
    "szn = df.groupby('year')[num_cols].mean().reset_index()\n",
    "szn['era'] = szn['year'].apply(assign_era)\n",
    "\n",
    "# Competitive balance: std dev of win% per season (lower = more parity)\n",
    "if COLS['win_pct']:\n",
    "    balance = df.groupby('year')[COLS['win_pct']].std().reset_index()\n",
    "    balance.columns = ['year', 'win_pct_std']\n",
    "    szn = szn.merge(balance, on='year', how='left')\n",
    "\n",
    "print(f\"‚úÖ {len(szn)} seasons | {df['year'].min():.0f}‚Äì{df['year'].max():.0f}\")\n",
    "print(f\"   Teams per season (latest): {df[df['year']==df['year'].max()].shape[0]}\")\n",
    "print(f\"   Numeric features: {len(num_cols)}\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "43961ac4",
   "metadata": {
    "papermill": {
     "duration": 0.005023,
     "end_time": "2026-02-16T20:45:55.665496",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.660473",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<div style=\"display: flex; gap: 15px; flex-wrap: wrap; margin: 20px 0;\">\n",
    "    <div style=\"flex:1; min-width:180px; background: linear-gradient(135deg, #002D72, #0a4a8a); padding: 20px; border-radius: 12px; text-align: center; color: white;\">\n",
    "        <div style=\"font-size: 14px; opacity: 0.8;\">üìÖ Seasons</div>\n",
    "        <div style=\"font-size: 32px; font-weight: 700; color: #FFD700;\">120+</div>\n",
    "    </div>\n",
    "    <div style=\"flex:1; min-width:180px; background: linear-gradient(135deg, #C41E3A, #8B0000); padding: 20px; border-radius: 12px; text-align: center; color: white;\">\n",
    "        <div style=\"font-size: 14px; opacity: 0.8;\">üèüÔ∏è Eras</div>\n",
    "        <div style=\"font-size: 32px; font-weight: 700; color: #FFD700;\">9</div>\n",
    "    </div>\n",
    "    <div style=\"flex:1; min-width:180px; background: linear-gradient(135deg, #002D72, #0a4a8a); padding: 20px; border-radius: 12px; text-align: center; color: white;\">\n",
    "        <div style=\"font-size: 14px; opacity: 0.8;\">üìä Features</div>\n",
    "        <div style=\"font-size: 32px; font-weight: 700; color: #FFD700;\">15+</div>\n",
    "    </div>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b0beb342",
   "metadata": {
    "papermill": {
     "duration": 0.004958,
     "end_time": "2026-02-16T20:45:55.676163",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.671205",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"4\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">üí• 4. Run Scoring Evolution</h2>\n",
    "</div>\n",
    "\n",
    "<div style=\"background: linear-gradient(135deg, #002D72, #0a4a8a); border-radius: 12px; padding: 20px; color: white; margin: 15px 0;\">\n",
    "    <h4 style=\"color: #FFD700; margin-bottom: 10px;\">üí° The Big Picture</h4>\n",
    "    <p style=\"font-size: 15px; line-height: 1.6;\">How has the run-scoring environment shifted over 120+ years? From the Deadball Era's pitcher dominance through the Steroid Era explosion ‚Äî run scoring is baseball's vital sign.</p>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "560a215e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:55.687512Z",
     "iopub.status.busy": "2026-02-16T20:45:55.687184Z",
     "iopub.status.idle": "2026-02-16T20:45:55.879495Z",
     "shell.execute_reply": "2026-02-16T20:45:55.878706Z"
    },
    "papermill": {
     "duration": 0.200349,
     "end_time": "2026-02-16T20:45:55.881403",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.681054",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<iframe\n",
       "    scrolling=\"no\"\n",
       "    width=\"100%\"\n",
       "    height=\"520\"\n",
       "    src=\"iframe_figures/figure_8.html\"\n",
       "    frameborder=\"0\"\n",
       "    allowfullscreen\n",
       "></iframe>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "Avg Runs/Team by Era:\n",
      "  Deadball (‚â§1919):  590\n",
      "  Steroid (1994-05): 757\n",
      "  Modern (2015+):    645\n",
      "  Swing: +28% Deadball‚ÜíSteroid\n"
     ]
    }
   ],
   "source": [
    "# ‚îÄ‚îÄ Run Scoring Evolution ‚îÄ‚îÄ\n",
    "rs_col = COLS.get('runs_scored')\n",
    "ra_col = COLS.get('runs_allowed')\n",
    "\n",
    "if rs_col and rs_col in szn.columns:\n",
    "    fig = go.Figure()\n",
    "    \n",
    "    fig.add_trace(go.Scatter(x=szn['year'], y=szn[rs_col], mode='lines',\n",
    "        name='Runs Scored (avg/team)', line=dict(color=MLB_RED, width=2.5),\n",
    "        fill='tozeroy', fillcolor='rgba(196,30,58,0.12)'))\n",
    "    \n",
    "    if ra_col and ra_col in szn.columns:\n",
    "        fig.add_trace(go.Scatter(x=szn['year'], y=szn[ra_col], mode='lines',\n",
    "            name='Runs Allowed (avg/team)', line=dict(color=MLB_BLUE, width=2.5, dash='dash')))\n",
    "    \n",
    "    # Era boundary lines\n",
    "    for b in [1920, 1942, 1946, 1963, 1977, 1994, 2006, 2015]:\n",
    "        fig.add_vline(x=b, line_dash='dot', line_color='gray', opacity=0.3)\n",
    "    \n",
    "    fig.update_layout(\n",
    "        title='<b>Run Scoring Evolution: 120 Years of MLB</b>',\n",
    "        font_family='Arial', title_font_size=18, height=500, plot_bgcolor='#fafafa',\n",
    "        xaxis_title='Year', yaxis_title='Runs per Team (Season Total)',\n",
    "        legend=dict(orientation='h', y=-0.15, x=0.5, xanchor='center'))\n",
    "    fig.show()\n",
    "    \n",
    "    deadball = szn.loc[szn['year']<=1919, rs_col].mean()\n",
    "    steroid  = szn.loc[szn['year'].between(1994,2005), rs_col].mean()\n",
    "    modern   = szn.loc[szn['year']>=2015, rs_col].mean()\n",
    "    print(f'\\nAvg Runs/Team by Era:')\n",
    "    print(f'  Deadball (‚â§1919):  {deadball:.0f}')\n",
    "    print(f'  Steroid (1994-05): {steroid:.0f}')\n",
    "    print(f'  Modern (2015+):    {modern:.0f}')\n",
    "    if deadball > 0:\n",
    "        print(f'  Swing: {(steroid/deadball-1)*100:+.0f}% Deadball‚ÜíSteroid')\n",
    "else:\n",
    "    print('‚ö†Ô∏è  runs_scored not found in season data')\n",
    "    print(f'   Available columns: {list(szn.columns)}')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f616978d",
   "metadata": {
    "papermill": {
     "duration": 0.00515,
     "end_time": "2026-02-16T20:45:55.891964",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.886814",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"5\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">‚ö° 5. Run Differential: The Engine of Winning</h2>\n",
    "</div>\n",
    "\n",
    "<div style=\"background: linear-gradient(135deg, #002D72, #0a4a8a); border-radius: 12px; padding: 20px; color: white; margin: 15px 0;\">\n",
    "    <h4 style=\"color: #FFD700; margin-bottom: 10px;\">üí° The Tightest Relationship in Sports</h4>\n",
    "    <p style=\"font-size: 15px; line-height: 1.6;\">In baseball, run differential predicts winning percentage better than almost any other stat in any sport. Let's quantify just how tight that relationship is across 2,600+ team-seasons.</p>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "b0de2ad6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:55.903876Z",
     "iopub.status.busy": "2026-02-16T20:45:55.903558Z",
     "iopub.status.idle": "2026-02-16T20:45:56.287591Z",
     "shell.execute_reply": "2026-02-16T20:45:56.286763Z"
    },
    "papermill": {
     "duration": 0.392473,
     "end_time": "2026-02-16T20:45:56.289542",
     "exception": false,
     "start_time": "2026-02-16T20:45:55.897069",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<iframe\n",
       "    scrolling=\"no\"\n",
       "    width=\"100%\"\n",
       "    height=\"570\"\n",
       "    src=\"iframe_figures/figure_9.html\"\n",
       "    frameborder=\"0\"\n",
       "    allowfullscreen\n",
       "></iframe>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "üìä Run Differential ‚Üí Win %:\n",
      "   R¬≤ = 0.883  (explains 88.3% of variance)\n",
      "   Each +10 runs ‚âà 0.007 higher win %\n"
     ]
    }
   ],
   "source": [
    "# ‚îÄ‚îÄ Run Differential vs Win% (every team-season) ‚îÄ‚îÄ\n",
    "rd_col = COLS.get('run_diff')\n",
    "wp_col = COLS.get('win_pct')\n",
    "\n",
    "if rd_col and wp_col and rd_col in df.columns and wp_col in df.columns:\n",
    "    fig = px.scatter(df, x=rd_col, y=wp_col, color='era',\n",
    "        color_discrete_map={\n",
    "            'Deadball Era':'#8B4513','Live Ball Era':'#DAA520','WWII Era':'#556B2F',\n",
    "            'Post-War Era':'#4682B4','Expansion Era':'#9370DB','Free Agency Era':'#2E8B57',\n",
    "            'Steroid Era':'#DC143C','Post-Steroid Era':'#FF8C00','Modern Era':'#1E90FF'},\n",
    "        hover_data=[COLS['team'], 'year'] if COLS.get('team') else ['year'],\n",
    "        opacity=0.5,\n",
    "        title='<b>Run Differential vs. Win %: Every Team-Season (1901‚ÄìPresent)</b>')\n",
    "    \n",
    "    # Trend line\n",
    "    from scipy import stats as sp\n",
    "    valid = df[[rd_col, wp_col]].dropna()\n",
    "    slope, intercept, r, p, se = sp.linregress(valid[rd_col], valid[wp_col])\n",
    "    x_range = np.linspace(valid[rd_col].min(), valid[rd_col].max(), 100)\n",
    "    fig.add_trace(go.Scatter(x=x_range, y=intercept + slope*x_range,\n",
    "        mode='lines', line=dict(color='black', width=2, dash='dash'),\n",
    "        name=f'Trend (R¬≤ = {r**2:.3f})', showlegend=True))\n",
    "    \n",
    "    fig.update_layout(font_family='Arial', title_font_size=18, height=550,\n",
    "        plot_bgcolor='#fafafa', xaxis_title='Run Differential',\n",
    "        yaxis_title='Winning Percentage',\n",
    "        legend=dict(font=dict(size=10)))\n",
    "    fig.show()\n",
    "    \n",
    "    print(f'\\nüìä Run Differential ‚Üí Win %:')\n",
    "    print(f'   R¬≤ = {r**2:.3f}  (explains {r**2*100:.1f}% of variance)')\n",
    "    print(f'   Each +10 runs ‚âà {slope*10:.3f} higher win %')\n",
    "else:\n",
    "    # Fallback: Runs Scored vs Allowed\n",
    "    rs, ra = COLS.get('runs_scored'), COLS.get('runs_allowed')\n",
    "    if rs and ra and rs in df.columns and ra in df.columns:\n",
    "        fig = px.scatter(df, x=rs, y=ra, color='era', opacity=0.4,\n",
    "            title='<b>Runs Scored vs. Runs Allowed</b>')\n",
    "        fig.add_trace(go.Scatter(x=[300,1000], y=[300,1000], mode='lines',\n",
    "            line=dict(color='black', dash='dash'), name='Break Even'))\n",
    "        fig.update_layout(font_family='Arial', title_font_size=18, height=500,\n",
    "            plot_bgcolor='#fafafa', xaxis_title='Runs Scored', yaxis_title='Runs Allowed')\n",
    "        fig.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "74a59eba",
   "metadata": {
    "papermill": {
     "duration": 0.005237,
     "end_time": "2026-02-16T20:45:56.300366",
     "exception": false,
     "start_time": "2026-02-16T20:45:56.295129",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"6\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">üß¨ 6. Baseball Genome Map (t-SNE)</h2>\n",
    "</div>\n",
    "\n",
    "<div style=\"background: linear-gradient(135deg, #002D72, #0a4a8a); border-radius: 12px; padding: 20px; color: white; margin: 15px 0;\">\n",
    "    <h4 style=\"color: #FFD700; margin-bottom: 10px;\">üí° What is the Genome Map?</h4>\n",
    "    <p style=\"font-size: 15px; line-height: 1.6;\">We take every season's multi-dimensional statistical profile and project it into 2D using <b>t-SNE</b>. Seasons that \"play similarly\" cluster together ‚Äî revealing which eras are truly distinct and which are surprisingly similar.</p>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "a088bc0a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:56.312669Z",
     "iopub.status.busy": "2026-02-16T20:45:56.312167Z",
     "iopub.status.idle": "2026-02-16T20:45:57.080539Z",
     "shell.execute_reply": "2026-02-16T20:45:57.079604Z"
    },
    "papermill": {
     "duration": 0.776706,
     "end_time": "2026-02-16T20:45:57.082295",
     "exception": false,
     "start_time": "2026-02-16T20:45:56.305589",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ t-SNE on 7 features, perplexity=15\n"
     ]
    }
   ],
   "source": [
    "skip = ['year','tto_rate','hr_rate','so_rate','bb_rate']\n",
    "gf = [c for c in szn.select_dtypes(include=[np.number]).columns if c not in skip and szn[c].notna().mean()>0.7 and szn[c].std()>0]\n",
    "scaler = StandardScaler()\n",
    "X = scaler.fit_transform(szn[gf].fillna(0))\n",
    "perp = min(15,len(szn)-1)\n",
    "coords = TSNE(n_components=2,perplexity=perp,random_state=42,n_iter=2000,learning_rate='auto').fit_transform(X)\n",
    "szn['gx'],szn['gy'] = coords[:,0],coords[:,1]\n",
    "print(f'‚úÖ t-SNE on {len(gf)} features, perplexity={perp}')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "ec3c0afb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:57.095053Z",
     "iopub.status.busy": "2026-02-16T20:45:57.094470Z",
     "iopub.status.idle": "2026-02-16T20:45:57.256136Z",
     "shell.execute_reply": "2026-02-16T20:45:57.255253Z"
    },
    "papermill": {
     "duration": 0.170079,
     "end_time": "2026-02-16T20:45:57.257973",
     "exception": false,
     "start_time": "2026-02-16T20:45:57.087894",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<iframe\n",
       "    scrolling=\"no\"\n",
       "    width=\"920px\"\n",
       "    height=\"720\"\n",
       "    src=\"iframe_figures/figure_11.html\"\n",
       "    frameborder=\"0\"\n",
       "    allowfullscreen\n",
       "></iframe>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "era_colors = {'Deadball Era':'#8B4513','Live Ball Era':'#DAA520','WWII Era':'#556B2F',\n",
    "    'Post-War Era':'#4682B4','Expansion Era':'#9370DB','Free Agency Era':'#2E8B57',\n",
    "    'Steroid Era':'#DC143C','Post-Steroid Era':'#FF8C00','TTO Era':'#1E90FF'}\n",
    "\n",
    "fig = px.scatter(szn, x='gx', y='gy', color='era', hover_data=['year'],\n",
    "    color_discrete_map=era_colors, text=szn['year'].astype(int).astype(str),\n",
    "    title='<b>‚öæ Baseball Genome Map ‚Äî 120 Years in Strategy Space</b>')\n",
    "fig.update_traces(textfont_size=7, textposition='top center', marker=dict(size=10,line=dict(width=0.5,color='white')))\n",
    "fig.update_layout(font_family='Arial',title_font_size=20,height=700,width=900,\n",
    "    plot_bgcolor='#fafafa',xaxis_title='Dimension 1',yaxis_title='Dimension 2',\n",
    "    legend=dict(title='Era',font=dict(size=11)))\n",
    "fig.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9634ce3a",
   "metadata": {
    "papermill": {
     "duration": 0.005382,
     "end_time": "2026-02-16T20:45:57.268888",
     "exception": false,
     "start_time": "2026-02-16T20:45:57.263506",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"7\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">üî• 7. Era Similarity Matrix</h2>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "0258aca1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:57.282027Z",
     "iopub.status.busy": "2026-02-16T20:45:57.281249Z",
     "iopub.status.idle": "2026-02-16T20:45:57.399250Z",
     "shell.execute_reply": "2026-02-16T20:45:57.398403Z"
    },
    "papermill": {
     "duration": 0.126388,
     "end_time": "2026-02-16T20:45:57.401013",
     "exception": false,
     "start_time": "2026-02-16T20:45:57.274625",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<iframe\n",
       "    scrolling=\"no\"\n",
       "    width=\"720px\"\n",
       "    height=\"620\"\n",
       "    src=\"iframe_figures/figure_12.html\"\n",
       "    frameborder=\"0\"\n",
       "    allowfullscreen\n",
       "></iframe>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "dist = pairwise_distances(X, metric='cosine')\n",
    "sim = 1 - dist\n",
    "yrs = szn['year'].values.astype(int)\n",
    "sim_df = pd.DataFrame(sim, index=yrs, columns=yrs)\n",
    "step = max(1, len(yrs)//25)\n",
    "sample = yrs[::step]\n",
    "sub = sim_df.loc[sample, sample]\n",
    "\n",
    "fig = px.imshow(sub, color_continuous_scale='RdYlBu_r', zmin=0.4, zmax=1.0,\n",
    "    title='<b>MLB Season Similarity Matrix (Cosine Similarity)</b>',\n",
    "    labels=dict(color='Similarity'))\n",
    "fig.update_layout(font_family='Arial',title_font_size=18,height=600,width=700)\n",
    "fig.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "ba26df2d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:57.414050Z",
     "iopub.status.busy": "2026-02-16T20:45:57.413281Z",
     "iopub.status.idle": "2026-02-16T20:45:57.472427Z",
     "shell.execute_reply": "2026-02-16T20:45:57.471492Z"
    },
    "papermill": {
     "duration": 0.06766,
     "end_time": "2026-02-16T20:45:57.474331",
     "exception": false,
     "start_time": "2026-02-16T20:45:57.406671",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<iframe\n",
       "    scrolling=\"no\"\n",
       "    width=\"100%\"\n",
       "    height=\"420\"\n",
       "    src=\"iframe_figures/figure_13.html\"\n",
       "    frameborder=\"0\"\n",
       "    allowfullscreen\n",
       "></iframe>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "Decade similarity to 2025:\n",
      "  1900s: 0.391  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  1910s: 0.413  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  1920s: -0.176  \n",
      "  1930s: -0.309  \n",
      "  1940s: 0.048  ‚ñà\n",
      "  1950s: 0.058  ‚ñà\n",
      "  1960s: -0.129  \n",
      "  1970s: -0.296  \n",
      "  1980s: -0.311  \n",
      "  1990s: -0.319  \n",
      "  2000s: -0.647  \n",
      "  2010s: -0.477  \n",
      "  2020s: -0.130  \n"
     ]
    }
   ],
   "source": [
    "latest = int(szn['year'].max())\n",
    "sim_now = sim_df[latest].sort_index()\n",
    "fig = go.Figure()\n",
    "fig.add_trace(go.Scatter(x=sim_now.index, y=sim_now.values, mode='lines',\n",
    "    fill='tozeroy', line=dict(color=MLB_BLUE,width=2), fillcolor='rgba(0,45,114,0.1)'))\n",
    "fig.update_layout(title=f'<b>How Similar Is Each Season to {latest} Baseball?</b>',\n",
    "    font_family='Arial',title_font_size=18,height=400,plot_bgcolor='#fafafa',\n",
    "    xaxis_title='Year',yaxis_title=f'Cosine Similarity to {latest}',yaxis_range=[0,1.05])\n",
    "fig.show()\n",
    "\n",
    "decade = sim_now.groupby(sim_now.index//10*10).mean()\n",
    "print(f'\\nDecade similarity to {latest}:')\n",
    "for d,v in decade.items():\n",
    "    bar = '‚ñà'*int(v*25)\n",
    "    print(f'  {d}s: {v:.3f}  {bar}')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8f0f8af4",
   "metadata": {
    "papermill": {
     "duration": 0.005794,
     "end_time": "2026-02-16T20:45:57.486000",
     "exception": false,
     "start_time": "2026-02-16T20:45:57.480206",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"8\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">üìä 8. Competitive Balance Across Eras</h2>\n",
    "</div>\n",
    "\n",
    "<div style=\"background: linear-gradient(135deg, #002D72, #0a4a8a); border-radius: 12px; padding: 20px; color: white; margin: 15px 0;\">\n",
    "    <h4 style=\"color: #FFD700; margin-bottom: 10px;\">üí° Measuring Parity</h4>\n",
    "    <p style=\"font-size: 15px; line-height: 1.6;\"><b>Standard deviation of winning percentage</b> each season tells us how spread out teams are. Lower = more parity (any team can win). Higher = more dynasties and doormats.</p>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "577a5699",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:57.499671Z",
     "iopub.status.busy": "2026-02-16T20:45:57.498707Z",
     "iopub.status.idle": "2026-02-16T20:45:57.600200Z",
     "shell.execute_reply": "2026-02-16T20:45:57.599224Z"
    },
    "papermill": {
     "duration": 0.110297,
     "end_time": "2026-02-16T20:45:57.601990",
     "exception": false,
     "start_time": "2026-02-16T20:45:57.491693",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<iframe\n",
       "    scrolling=\"no\"\n",
       "    width=\"100%\"\n",
       "    height=\"470\"\n",
       "    src=\"iframe_figures/figure_14.html\"\n",
       "    frameborder=\"0\"\n",
       "    allowfullscreen\n",
       "></iframe>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "Competitive Balance by Era (lower = more parity):\n",
      "  Post-Steroid Era    : 0.0672  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  Free Agency Era     : 0.0685  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  Expansion Era       : 0.0736  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  Steroid Era         : 0.0738  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  Modern Era          : 0.0844  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  Post-War Era        : 0.0911  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  WWII Era            : 0.0963  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  Live Ball Era       : 0.0970  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "  Deadball Era        : 0.1084  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n"
     ]
    }
   ],
   "source": [
    "# ‚îÄ‚îÄ Competitive Balance Over Time ‚îÄ‚îÄ\n",
    "if 'win_pct_std' in szn.columns:\n",
    "    fig = go.Figure()\n",
    "    \n",
    "    # Raw data (faded)\n",
    "    fig.add_trace(go.Scatter(x=szn['year'], y=szn['win_pct_std'], mode='lines',\n",
    "        line=dict(color=MLB_BLUE, width=1), opacity=0.3, name='Annual', showlegend=False))\n",
    "    \n",
    "    # 5-year rolling average\n",
    "    szn['balance_smooth'] = szn['win_pct_std'].rolling(5, center=True).mean()\n",
    "    fig.add_trace(go.Scatter(x=szn['year'], y=szn['balance_smooth'], mode='lines',\n",
    "        line=dict(color=MLB_RED, width=3), name='5-Year Rolling Avg'))\n",
    "    \n",
    "    # Era boundaries\n",
    "    for b in [1920, 1942, 1946, 1963, 1977, 1994, 2006, 2015]:\n",
    "        fig.add_vline(x=b, line_dash='dot', line_color='gray', opacity=0.3)\n",
    "    \n",
    "    fig.update_layout(\n",
    "        title='<b>Competitive Balance: Std Dev of Win % by Season</b><br><sup>Lower = more parity ‚Ä¢ Higher = more dynasties</sup>',\n",
    "        font_family='Arial', title_font_size=18, height=450, plot_bgcolor='#fafafa',\n",
    "        xaxis_title='Year', yaxis_title='Std Dev of Win %',\n",
    "        legend=dict(orientation='h', y=-0.15))\n",
    "    fig.show()\n",
    "    \n",
    "    # Era-level summary\n",
    "    era_bal = szn.groupby('era')['win_pct_std'].mean().sort_values()\n",
    "    print('\\nCompetitive Balance by Era (lower = more parity):')\n",
    "    for era, val in era_bal.items():\n",
    "        bar = '‚ñà' * int(val * 300)\n",
    "        print(f'  {era:20s}: {val:.4f}  {bar}')\n",
    "else:\n",
    "    print('‚ö†Ô∏è  win_pct_std not available ‚Äî needs winning_percentage column')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cb7192db",
   "metadata": {
    "papermill": {
     "duration": 0.005793,
     "end_time": "2026-02-16T20:45:57.613698",
     "exception": false,
     "start_time": "2026-02-16T20:45:57.607905",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"9\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">üî¨ 9. Era Fingerprints</h2>\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "12101441",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2026-02-16T20:45:57.627529Z",
     "iopub.status.busy": "2026-02-16T20:45:57.627183Z",
     "iopub.status.idle": "2026-02-16T20:45:57.718651Z",
     "shell.execute_reply": "2026-02-16T20:45:57.717792Z"
    },
    "papermill": {
     "duration": 0.101084,
     "end_time": "2026-02-16T20:45:57.720411",
     "exception": false,
     "start_time": "2026-02-16T20:45:57.619327",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<iframe\n",
       "    scrolling=\"no\"\n",
       "    width=\"920px\"\n",
       "    height=\"470\"\n",
       "    src=\"iframe_figures/figure_15.html\"\n",
       "    frameborder=\"0\"\n",
       "    allowfullscreen\n",
       "></iframe>\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# ‚îÄ‚îÄ Era Statistical Fingerprints ‚îÄ‚îÄ\n",
    "# Use ACTUAL available numeric columns\n",
    "fp_candidates = ['runs_scored', 'runs_allowed', 'run_differential',\n",
    "                 'winning_percentage', 'wins', 'losses']\n",
    "# Also try the COLS mappings\n",
    "for key in ['runs_scored', 'runs_allowed', 'run_diff', 'win_pct', 'wins', 'losses']:\n",
    "    if COLS.get(key):\n",
    "        fp_candidates.append(COLS[key])\n",
    "# Add competitive balance\n",
    "if 'win_pct_std' in szn.columns:\n",
    "    fp_candidates.append('win_pct_std')\n",
    "\n",
    "# Deduplicate and filter to columns that actually exist in szn\n",
    "fp = list(dict.fromkeys(c for c in fp_candidates if c in szn.columns))\n",
    "\n",
    "if len(fp) >= 3:\n",
    "    ep = szn.groupby('era')[fp].mean()\n",
    "    # Normalize 0-1\n",
    "    en = ((ep - ep.min()) / (ep.max() - ep.min())).fillna(0)\n",
    "    era_order = ['Deadball Era','Live Ball Era','WWII Era','Post-War Era','Expansion Era',\n",
    "                 'Free Agency Era','Steroid Era','Post-Steroid Era','Modern Era']\n",
    "    en = en.reindex([e for e in era_order if e in en.index])\n",
    "    \n",
    "    fig = px.imshow(en.T, color_continuous_scale='YlOrRd',\n",
    "        title='<b>Era Statistical Fingerprints (Normalized 0‚Äì1)</b>',\n",
    "        labels=dict(x='Era', y='Metric', color='Normalized'))\n",
    "    fig.update_layout(font_family='Arial', title_font_size=18, height=450, width=900)\n",
    "    fig.show()\n",
    "else:\n",
    "    print(f'‚ö†Ô∏è  Only {len(fp)} metrics found, need 3+')\n",
    "    print(f'   Available: {list(szn.columns)}')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "976ec5ff",
   "metadata": {
    "papermill": {
     "duration": 0.005916,
     "end_time": "2026-02-16T20:45:57.732461",
     "exception": false,
     "start_time": "2026-02-16T20:45:57.726545",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<a id=\"10\"></a>\n",
    "<div style=\"background: linear-gradient(to right, #002D72, #1a1a2e); padding: 15px 20px; border-radius: 8px; margin-top: 20px;\">\n",
    "    <h2 style=\"color: #FFFFFF; margin: 0;\">üèÜ 10. Conclusions</h2>\n",
    "</div>\n",
    "\n",
    "---\n",
    "\n",
    "<div style=\"background: linear-gradient(135deg, #002D72, #C41E3A); padding: 25px; border-radius: 15px; margin: 20px 0;\">\n",
    "    <h3 style=\"color: #FFD700; text-align: center;\">Key Findings</h3>\n",
    "    <div style=\"display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 15px;\">\n",
    "        <div style=\"background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center; min-width: 180px;\">\n",
    "            <div style=\"font-size: 28px;\">üß¨</div>\n",
    "            <div style=\"color: #FFD700; font-weight: 700;\">Genome Map</div>\n",
    "            <div style=\"color: #CCC; font-size: 12px;\">Eras form distinct islands ‚Äî<br>phase shifts, not gradual drift</div>\n",
    "        </div>\n",
    "        <div style=\"background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center; min-width: 180px;\">\n",
    "            <div style=\"font-size: 28px;\">üìà</div>\n",
    "            <div style=\"color: #FFD700; font-weight: 700;\">Run Scoring</div>\n",
    "            <div style=\"color: #CCC; font-size: 12px;\">¬±30% variation across<br>120 years of baseball</div>\n",
    "        </div>\n",
    "        <div style=\"background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center; min-width: 180px;\">\n",
    "            <div style=\"font-size: 28px;\">üéØ</div>\n",
    "            <div style=\"color: #FFD700; font-weight: 700;\">Run Diff = Destiny</div>\n",
    "            <div style=\"color: #CCC; font-size: 12px;\">R¬≤ > 0.85 ‚Äî the tightest<br>predictor in sports</div>\n",
    "        </div>\n",
    "        <div style=\"background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center; min-width: 180px;\">\n",
    "            <div style=\"font-size: 28px;\">‚öñÔ∏è</div>\n",
    "            <div style=\"color: #FFD700; font-weight: 700;\">Parity Fluctuates</div>\n",
    "            <div style=\"color: #CCC; font-size: 12px;\">Some eras bred dynasties,<br>others gave everyone a shot</div>\n",
    "        </div>\n",
    "    </div>\n",
    "</div>\n",
    "\n",
    "### Key Findings\n",
    "\n",
    "**1. Baseball eras form distinct \"islands\" in strategy space.** The Genome Map reveals that transitions between eras are sudden phase shifts, not gradual evolution. The Deadball Era and Modern Era occupy completely different regions.\n",
    "\n",
    "**2. Run scoring has swung dramatically.** The Deadball Era's pitcher dominance vs. the Steroid Era explosion represents a 30%+ swing in the game's fundamental scoring rate.\n",
    "\n",
    "**3. Run differential is the most predictive stat in all of sports.** With R¬≤ above 0.85, run differential explains nearly all variance in winning percentage ‚Äî better than any comparable metric in the NFL, NBA, or NHL.\n",
    "\n",
    "**4. Competitive balance has fluctuated by era.** Measuring the spread of winning percentages reveals which periods produced dynasties vs. parity.\n",
    "\n",
    "**5. Modern baseball echoes the 1990s.** Despite new rules and strategies, the cosine similarity matrix shows today's game is statistically closest to the pre-Steroid era.\n",
    "\n",
    "---\n",
    "\n",
    "<div style=\"text-align: center; padding: 20px; color: #888;\">\n",
    "    <p><b>Thanks for reading!</b> If you found this interesting, please upvote. üëç</p>\n",
    "    <p style=\"font-size: 12px;\">Built with Python ‚Ä¢ pandas ‚Ä¢ Plotly ‚Ä¢ scikit-learn | 2,690 team-seasons analyzed</p>\n",
    "</div>"
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "none",
   "dataSources": [
    {
     "datasetId": 7449052,
     "sourceId": 12049650,
     "sourceType": "datasetVersion"
    }
   ],
   "dockerImageVersionId": 31259,
   "isGpuEnabled": false,
   "isInternetEnabled": false,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.12"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 13.250993,
   "end_time": "2026-02-16T20:45:58.658682",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2026-02-16T20:45:45.407689",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
